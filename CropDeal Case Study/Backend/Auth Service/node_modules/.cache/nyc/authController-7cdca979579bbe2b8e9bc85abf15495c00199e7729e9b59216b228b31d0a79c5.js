function cov_1kxuicdsvg(){var path="C:\\Users\\DELL\\Desktop\\CropDeal Case Study\\CropDeal\\Auth Service\\api\\controllers\\authController.js";var hash="9ca15634174e60c8ee494f605ea5eee55b0bdec8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\DELL\\Desktop\\CropDeal Case Study\\CropDeal\\Auth Service\\api\\controllers\\authController.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:12},end:{line:2,column:35}},"2":{start:{line:3,column:15},end:{line:3,column:34}},"3":{start:{line:4,column:21},end:{line:4,column:51}},"4":{start:{line:5,column:15},end:{line:5,column:32}},"5":{start:{line:6,column:19},end:{line:6,column:21}},"6":{start:{line:9,column:0},end:{line:42,column:1}},"7":{start:{line:10,column:4},end:{line:10,column:27}},"8":{start:{line:12,column:4},end:{line:41,column:7}},"9":{start:{line:13,column:8},end:{line:40,column:9}},"10":{start:{line:14,column:12},end:{line:14,column:26}},"11":{start:{line:16,column:13},end:{line:40,column:9}},"12":{start:{line:17,column:12},end:{line:17,column:104}},"13":{start:{line:20,column:12},end:{line:24,column:14}},"14":{start:{line:27,column:25},end:{line:27,column:55}},"15":{start:{line:28,column:25},end:{line:28,column:64}},"16":{start:{line:29,column:12},end:{line:29,column:36}},"17":{start:{line:33,column:26},end:{line:33,column:53}},"18":{start:{line:34,column:12},end:{line:39,column:15}},"19":{start:{line:35,column:16},end:{line:37,column:17}},"20":{start:{line:36,column:20},end:{line:36,column:63}},"21":{start:{line:38,column:16},end:{line:38,column:59}},"22":{start:{line:45,column:0},end:{line:77,column:1}},"23":{start:{line:47,column:4},end:{line:47,column:27}},"24":{start:{line:48,column:4},end:{line:48,column:33}},"25":{start:{line:49,column:4},end:{line:49,column:20}},"26":{start:{line:50,column:4},end:{line:76,column:7}},"27":{start:{line:51,column:8},end:{line:75,column:9}},"28":{start:{line:52,column:12},end:{line:52,column:29}},"29":{start:{line:53,column:12},end:{line:53,column:26}},"30":{start:{line:55,column:13},end:{line:75,column:9}},"31":{start:{line:57,column:12},end:{line:57,column:66}},"32":{start:{line:58,column:12},end:{line:71,column:13}},"33":{start:{line:59,column:16},end:{line:62,column:17}},"34":{start:{line:63,column:36},end:{line:63,column:72}},"35":{start:{line:66,column:16},end:{line:66,column:96}},"36":{start:{line:70,column:16},end:{line:70,column:75}},"37":{start:{line:74,column:12},end:{line:74,column:70}},"38":{start:{line:81,column:0},end:{line:100,column:1}},"39":{start:{line:83,column:4},end:{line:99,column:5}},"40":{start:{line:84,column:8},end:{line:84,column:30}},"41":{start:{line:85,column:8},end:{line:95,column:11}},"42":{start:{line:86,column:12},end:{line:94,column:13}},"43":{start:{line:87,column:16},end:{line:87,column:58}},"44":{start:{line:89,column:17},end:{line:94,column:13}},"45":{start:{line:90,column:16},end:{line:90,column:58}},"46":{start:{line:93,column:16},end:{line:93,column:71}},"47":{start:{line:98,column:8},end:{line:98,column:63}},"48":{start:{line:103,column:0},end:{line:115,column:1}},"49":{start:{line:105,column:4},end:{line:114,column:6}},"50":{start:{line:109,column:8},end:{line:109,column:49}},"51":{start:{line:113,column:8},end:{line:113,column:48}},"52":{start:{line:120,column:0},end:{line:123,column:1}},"53":{start:{line:122,column:4},end:{line:122,column:50}},"54":{start:{line:126,column:0},end:{line:138,column:1}},"55":{start:{line:127,column:23},end:{line:127,column:51}},"56":{start:{line:128,column:18},end:{line:128,column:56}},"57":{start:{line:130,column:4},end:{line:130,column:50}},"58":{start:{line:130,column:23},end:{line:130,column:50}},"59":{start:{line:132,column:4},end:{line:137,column:6}},"60":{start:{line:134,column:8},end:{line:134,column:44}},"61":{start:{line:134,column:17},end:{line:134,column:44}},"62":{start:{line:135,column:8},end:{line:135,column:35}},"63":{start:{line:136,column:8},end:{line:136,column:14}},"64":{start:{line:143,column:4},end:{line:143,column:82}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:23},end:{line:9,column:24}},loc:{start:{line:9,column:43},end:{line:42,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:56},end:{line:12,column:57}},loc:{start:{line:12,column:77},end:{line:41,column:5}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:34,column:25},end:{line:34,column:26}},loc:{start:{line:34,column:46},end:{line:39,column:13}},line:34},"3":{name:"(anonymous_3)",decl:{start:{line:45,column:20},end:{line:45,column:21}},loc:{start:{line:45,column:40},end:{line:77,column:1}},line:45},"4":{name:"(anonymous_4)",decl:{start:{line:50,column:45},end:{line:50,column:46}},loc:{start:{line:50,column:66},end:{line:76,column:5}},line:50},"5":{name:"(anonymous_5)",decl:{start:{line:81,column:21},end:{line:81,column:22}},loc:{start:{line:81,column:41},end:{line:100,column:1}},line:81},"6":{name:"(anonymous_6)",decl:{start:{line:85,column:51},end:{line:85,column:52}},loc:{start:{line:85,column:72},end:{line:95,column:9}},line:85},"7":{name:"(anonymous_7)",decl:{start:{line:103,column:24},end:{line:103,column:25}},loc:{start:{line:103,column:44},end:{line:115,column:1}},line:103},"8":{name:"(anonymous_8)",decl:{start:{line:106,column:10},end:{line:106,column:11}},loc:{start:{line:107,column:4},end:{line:110,column:5}},line:107},"9":{name:"(anonymous_9)",decl:{start:{line:111,column:11},end:{line:111,column:12}},loc:{start:{line:112,column:4},end:{line:114,column:5}},line:112},"10":{name:"(anonymous_10)",decl:{start:{line:120,column:24},end:{line:120,column:25}},loc:{start:{line:120,column:44},end:{line:123,column:1}},line:120},"11":{name:"(anonymous_11)",decl:{start:{line:126,column:28},end:{line:126,column:29}},loc:{start:{line:126,column:54},end:{line:138,column:1}},line:126},"12":{name:"(anonymous_12)",decl:{start:{line:132,column:55},end:{line:132,column:56}},loc:{start:{line:132,column:81},end:{line:137,column:5}},line:132},"13":{name:"generateAccessToken",decl:{start:{line:142,column:9},end:{line:142,column:28}},loc:{start:{line:142,column:38},end:{line:144,column:1}},line:142}},branchMap:{"0":{loc:{start:{line:13,column:8},end:{line:40,column:9}},type:"if",locations:[{start:{line:13,column:8},end:{line:40,column:9}},{start:{line:13,column:8},end:{line:40,column:9}}],line:13},"1":{loc:{start:{line:16,column:13},end:{line:40,column:9}},type:"if",locations:[{start:{line:16,column:13},end:{line:40,column:9}},{start:{line:16,column:13},end:{line:40,column:9}}],line:16},"2":{loc:{start:{line:35,column:16},end:{line:37,column:17}},type:"if",locations:[{start:{line:35,column:16},end:{line:37,column:17}},{start:{line:35,column:16},end:{line:37,column:17}}],line:35},"3":{loc:{start:{line:51,column:8},end:{line:75,column:9}},type:"if",locations:[{start:{line:51,column:8},end:{line:75,column:9}},{start:{line:51,column:8},end:{line:75,column:9}}],line:51},"4":{loc:{start:{line:55,column:13},end:{line:75,column:9}},type:"if",locations:[{start:{line:55,column:13},end:{line:75,column:9}},{start:{line:55,column:13},end:{line:75,column:9}}],line:55},"5":{loc:{start:{line:58,column:12},end:{line:71,column:13}},type:"if",locations:[{start:{line:58,column:12},end:{line:71,column:13}},{start:{line:58,column:12},end:{line:71,column:13}}],line:58},"6":{loc:{start:{line:83,column:4},end:{line:99,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:99,column:5}},{start:{line:83,column:4},end:{line:99,column:5}}],line:83},"7":{loc:{start:{line:86,column:12},end:{line:94,column:13}},type:"if",locations:[{start:{line:86,column:12},end:{line:94,column:13}},{start:{line:86,column:12},end:{line:94,column:13}}],line:86},"8":{loc:{start:{line:89,column:17},end:{line:94,column:13}},type:"if",locations:[{start:{line:89,column:17},end:{line:94,column:13}},{start:{line:89,column:17},end:{line:94,column:13}}],line:89},"9":{loc:{start:{line:128,column:18},end:{line:128,column:56}},type:"binary-expr",locations:[{start:{line:128,column:18},end:{line:128,column:28}},{start:{line:128,column:32},end:{line:128,column:56}}],line:128},"10":{loc:{start:{line:130,column:4},end:{line:130,column:50}},type:"if",locations:[{start:{line:130,column:4},end:{line:130,column:50}},{start:{line:130,column:4},end:{line:130,column:50}}],line:130},"11":{loc:{start:{line:134,column:8},end:{line:134,column:44}},type:"if",locations:[{start:{line:134,column:8},end:{line:134,column:44}},{start:{line:134,column:8},end:{line:134,column:44}}],line:134}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9ca15634174e60c8ee494f605ea5eee55b0bdec8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1kxuicdsvg=function(){return actualCoverage;};}return actualCoverage;}cov_1kxuicdsvg();cov_1kxuicdsvg().s[0]++;require('dotenv').config();const jwt=(cov_1kxuicdsvg().s[1]++,require('jsonwebtoken'));var mongoose=(cov_1kxuicdsvg().s[2]++,require('mongoose')),userCredential=(cov_1kxuicdsvg().s[3]++,require('../models/authModel'));const bcrypt=(cov_1kxuicdsvg().s[4]++,require('bcrypt'));const saltRounds=(cov_1kxuicdsvg().s[5]++,10);//function to register user
cov_1kxuicdsvg().s[6]++;exports.registerUser=function(req,res){cov_1kxuicdsvg().f[0]++;cov_1kxuicdsvg().s[7]++;email=req.body.email;//to check whether email is already present in database
cov_1kxuicdsvg().s[8]++;userCredential.find({email:email},{"_id":1},function(err,user){cov_1kxuicdsvg().f[1]++;cov_1kxuicdsvg().s[9]++;if(err){cov_1kxuicdsvg().b[0][0]++;cov_1kxuicdsvg().s[10]++;res.send(err);}else{cov_1kxuicdsvg().b[0][1]++;cov_1kxuicdsvg().s[11]++;if(user.length>0){cov_1kxuicdsvg().b[1][0]++;cov_1kxuicdsvg().s[12]++;res.json({success:false,message:"email id already present...try with different email"});}else{cov_1kxuicdsvg().b[1][1]++;cov_1kxuicdsvg().s[13]++;userObj={email:req.body.email,password:req.body.password,userType:req.body.userType};//console.log(userObj);
//encrypt password
const salt=(cov_1kxuicdsvg().s[14]++,bcrypt.genSaltSync(saltRounds));const hash=(cov_1kxuicdsvg().s[15]++,bcrypt.hashSync(userObj.password,salt));cov_1kxuicdsvg().s[16]++;userObj.password=hash;//console.log(userObj);
//console.log("in fun"+userObj.password);
var newUser=(cov_1kxuicdsvg().s[17]++,new userCredential(userObj));cov_1kxuicdsvg().s[18]++;newUser.save(function(err,user){cov_1kxuicdsvg().f[2]++;cov_1kxuicdsvg().s[19]++;if(err){cov_1kxuicdsvg().b[2][0]++;cov_1kxuicdsvg().s[20]++;res.json({success:false,message:err});}else{cov_1kxuicdsvg().b[2][1]++;}cov_1kxuicdsvg().s[21]++;res.json({success:true,message:user});});}}});};//function to login user and send token
cov_1kxuicdsvg().s[22]++;exports.loginUser=function(req,res){cov_1kxuicdsvg().f[3]++;cov_1kxuicdsvg().s[23]++;//console.log(req.body);
email=req.body.email;cov_1kxuicdsvg().s[24]++;password=req.body.password;cov_1kxuicdsvg().s[25]++;isMatch=false;cov_1kxuicdsvg().s[26]++;userCredential.findOne({email:email},function(err,user){cov_1kxuicdsvg().f[4]++;cov_1kxuicdsvg().s[27]++;if(err){cov_1kxuicdsvg().b[3][0]++;cov_1kxuicdsvg().s[28]++;console.log(err);cov_1kxuicdsvg().s[29]++;res.send(err);}else{cov_1kxuicdsvg().b[3][1]++;cov_1kxuicdsvg().s[30]++;if(user){cov_1kxuicdsvg().b[4][0]++;cov_1kxuicdsvg().s[31]++;//compare hashed password
isMatch=bcrypt.compareSync(password,user.password);cov_1kxuicdsvg().s[32]++;if(isMatch){cov_1kxuicdsvg().b[5][0]++;cov_1kxuicdsvg().s[33]++;userdataInToken={email:user.email,userType:user.userType};const accessToken=(cov_1kxuicdsvg().s[34]++,generateAccessToken(userdataInToken));//const refreshToken = jwt.sign(user, process.env.REFRESH_TOKEN_SECRET)
//refreshTokens.push(refreshToken)
cov_1kxuicdsvg().s[35]++;res.json({success:true,accessToken:accessToken,userData:userdataInToken});//res.json(user);
}else{cov_1kxuicdsvg().b[5][1]++;cov_1kxuicdsvg().s[36]++;res.json({success:false,message:"password incorrect"});}}else{cov_1kxuicdsvg().b[4][1]++;cov_1kxuicdsvg().s[37]++;res.json({success:false,message:"email not present"});}}});};//function to delete user on request of admin
cov_1kxuicdsvg().s[38]++;exports.deleteUser=function(req,res){cov_1kxuicdsvg().f[5]++;cov_1kxuicdsvg().s[39]++;//here req.user comes from authentication function
if(req.user.userType=="admin"){cov_1kxuicdsvg().b[6][0]++;cov_1kxuicdsvg().s[40]++;email=req.params.id;cov_1kxuicdsvg().s[41]++;userCredential.deleteOne({email:email},function(err,user){cov_1kxuicdsvg().f[6]++;cov_1kxuicdsvg().s[42]++;if(err){cov_1kxuicdsvg().b[7][0]++;cov_1kxuicdsvg().s[43]++;res.json({success:false,message:err});}else{cov_1kxuicdsvg().b[7][1]++;cov_1kxuicdsvg().s[44]++;if(user){cov_1kxuicdsvg().b[8][0]++;cov_1kxuicdsvg().s[45]++;res.json({success:true,message:user});}else{cov_1kxuicdsvg().b[8][1]++;cov_1kxuicdsvg().s[46]++;res.json({success:false,message:"user not found"});}}});}else{cov_1kxuicdsvg().b[6][1]++;cov_1kxuicdsvg().s[47]++;res.json({success:false,message:"user is not admin"});}};//function to send all users emails id for validation of duplicate email
cov_1kxuicdsvg().s[48]++;exports.getUsersEmail=function(req,res){cov_1kxuicdsvg().f[7]++;cov_1kxuicdsvg().s[49]++;userCredential.find({},{"email":1}).then(emails=>{cov_1kxuicdsvg().f[8]++;cov_1kxuicdsvg().s[50]++;//console.log(emails);
res.json({success:true,message:emails});}).catch(err=>{cov_1kxuicdsvg().f[9]++;cov_1kxuicdsvg().s[51]++;res.json({success:false,message:err});});};//function to authorize user from different micro service
cov_1kxuicdsvg().s[52]++;exports.authorizeUser=function(req,res){cov_1kxuicdsvg().f[10]++;cov_1kxuicdsvg().s[53]++;//console.log("authorized");
res.json({success:true,message:req.user});};//function to authenticate token
cov_1kxuicdsvg().s[54]++;exports.authenticateToken=function(req,res,next){cov_1kxuicdsvg().f[11]++;const authHeader=(cov_1kxuicdsvg().s[55]++,req.headers['authorization']);const token=(cov_1kxuicdsvg().s[56]++,(cov_1kxuicdsvg().b[9][0]++,authHeader)&&(cov_1kxuicdsvg().b[9][1]++,authHeader.split(' ')[1]));//if there  in no token present or no authorization header it will send 401
cov_1kxuicdsvg().s[57]++;if(token==null){cov_1kxuicdsvg().b[10][0]++;cov_1kxuicdsvg().s[58]++;return res.sendStatus(401);}else{cov_1kxuicdsvg().b[10][1]++;}cov_1kxuicdsvg().s[59]++;jwt.verify(token,process.env.ACCESS_TOKEN_SECRET,(err,userdataInToken)=>{cov_1kxuicdsvg().f[12]++;cov_1kxuicdsvg().s[60]++;//console.log(err)
if(err){cov_1kxuicdsvg().b[11][0]++;cov_1kxuicdsvg().s[61]++;return res.sendStatus(403);}else{cov_1kxuicdsvg().b[11][1]++;}cov_1kxuicdsvg().s[62]++;req.user=userdataInToken;cov_1kxuicdsvg().s[63]++;next();});};//function to generate token
function generateAccessToken(userObj){cov_1kxuicdsvg().f[13]++;cov_1kxuicdsvg().s[64]++;return jwt.sign(userObj,process.env.ACCESS_TOKEN_SECRET,{expiresIn:'3h'});}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJqd3QiLCJtb25nb29zZSIsInVzZXJDcmVkZW50aWFsIiwiYmNyeXB0Iiwic2FsdFJvdW5kcyIsImV4cG9ydHMiLCJyZWdpc3RlclVzZXIiLCJyZXEiLCJyZXMiLCJlbWFpbCIsImJvZHkiLCJmaW5kIiwiZXJyIiwidXNlciIsInNlbmQiLCJsZW5ndGgiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ1c2VyT2JqIiwicGFzc3dvcmQiLCJ1c2VyVHlwZSIsInNhbHQiLCJnZW5TYWx0U3luYyIsImhhc2giLCJoYXNoU3luYyIsIm5ld1VzZXIiLCJzYXZlIiwibG9naW5Vc2VyIiwiaXNNYXRjaCIsImZpbmRPbmUiLCJjb25zb2xlIiwibG9nIiwiY29tcGFyZVN5bmMiLCJ1c2VyZGF0YUluVG9rZW4iLCJhY2Nlc3NUb2tlbiIsImdlbmVyYXRlQWNjZXNzVG9rZW4iLCJ1c2VyRGF0YSIsImRlbGV0ZVVzZXIiLCJwYXJhbXMiLCJpZCIsImRlbGV0ZU9uZSIsImdldFVzZXJzRW1haWwiLCJ0aGVuIiwiZW1haWxzIiwiY2F0Y2giLCJhdXRob3JpemVVc2VyIiwiYXV0aGVudGljYXRlVG9rZW4iLCJuZXh0IiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJ0b2tlbiIsInNwbGl0Iiwic2VuZFN0YXR1cyIsInZlcmlmeSIsInByb2Nlc3MiLCJlbnYiLCJBQ0NFU1NfVE9LRU5fU0VDUkVUIiwic2lnbiIsImV4cGlyZXNJbiJdLCJtYXBwaW5ncyI6Ijh3U0FlWTttSEFmWkEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEIsR0FDQSxLQUFNQyxDQUFBQSxHQUFHLDBCQUFHRixPQUFPLENBQUMsY0FBRCxDQUFWLENBQVQsQ0FDQSxHQUFJRyxDQUFBQSxRQUFRLDBCQUFHSCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDSUksY0FBYywwQkFBR0osT0FBTyxDQUFDLHFCQUFE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LENBQUMwQyxpQkFBUixDQUE0QixTQUFVeEMsR0FBVixDQUFlQyxHQUFmLENBQW9Cd0MsSUFBcEIsQ0FBMEIsMEJBQ2xELEtBQU1DLENBQUFBLFVBQVUsMkJBQUcxQyxHQUFHLENBQUMyQyxPQUFKLENBQVksZUFBWixDQUFILENBQWhCLENBQ0EsS0FBTUMsQ0FBQUEsS0FBSywyQkFBRyw0QkFBQUYsVUFBVSwrQkFBSUEsVUFBVSxDQUFDRyxLQUFYLENBQWlCLEdBQWpCLEVBQXNCLENBQXRCLENBQUosQ0FBYixDQUFYLENBQ0E7QUFIa0QseUJBSWxELEdBQUlELEtBQUssRUFBSSxJQUFiLENBQW1CLDREQUFPM0MsQ0FBQUEsR0FBRyxDQUFDNkMsVUFBSixDQUFlLEdBQWYsQ0FBUCxDQUEyQixDQUE5QyxrQ0FKa0QseUJBTWxEckQsR0FBRyxDQUFDc0QsTUFBSixDQUFXSCxLQUFYLENBQWtCSSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsbUJBQTlCLENBQW1ELENBQUM3QyxHQUFELENBQU1zQixlQUFOLEdBQTBCLG1EQUN6RTtBQUNBLEdBQUl0QixHQUFKLENBQVMsNERBQU9KLENBQUFBLEdBQUcsQ0FBQzZDLFVBQUosQ0FBZSxHQUFmLENBQVAsQ0FBMkIsQ0FBcEMsa0NBRnlFLHlCQUd6RTlDLEdBQUcsQ0FBQ00sSUFBSixDQUFXcUIsZUFBWCxDQUh5RSx5QkFJekVjLElBQUksR0FDUCxDQUxELEVBTUgsQ0FaRCxDQWVBO0FBQ0EsUUFBU1osQ0FBQUEsbUJBQVQsQ0FBNkJqQixPQUE3QixDQUFzQyxtREFDbEMsTUFBT25CLENBQUFBLEdBQUcsQ0FBQzBELElBQUosQ0FBU3ZDLE9BQVQsQ0FBa0JvQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsbUJBQTlCLENBQW1ELENBQUVFLFNBQVMsQ0FBRSxJQUFiLENBQW5ELENBQVAsQ0FDSCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXHJcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpXHJcbnZhciBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyksXHJcbiAgICB1c2VyQ3JlZGVudGlhbCA9IHJlcXVpcmUoJy4uL21vZGVscy9hdXRoTW9kZWwnKTtcclxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0Jyk7XHJcbmNvbnN0IHNhbHRSb3VuZHMgPSAxMDtcclxuXHJcbi8vZnVuY3Rpb24gdG8gcmVnaXN0ZXIgdXNlclxyXG5leHBvcnRzLnJlZ2lzdGVyVXNlciA9IGZ1bmN0aW9uIChyZXEsIHJlcykge1xyXG4gICAgZW1haWwgPSByZXEuYm9keS5lbWFpbDtcclxuICAgIC8vdG8gY2hlY2sgd2hldGhlciBlbWFpbCBpcyBhbHJlYWR5IHByZXNlbnQgaW4gZGF0YWJhc2VcclxuICAgIHVzZXJDcmVkZW50aWFsLmZpbmQoeyBlbWFpbDogZW1haWwgfSwgeyBcIl9pZFwiOiAxIH0sIGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHVzZXIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcImVtYWlsIGlkIGFscmVhZHkgcHJlc2VudC4uLnRyeSB3aXRoIGRpZmZlcmVudCBlbWFpbFwiIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB1c2VyT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgZW1haWw6IHJlcS5ib2R5LmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHJlcS5ib2R5LnBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgdXNlclR5cGU6IHJlcS5ib2R5LnVzZXJUeXBlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2codXNlck9iaik7XHJcbiAgICAgICAgICAgIC8vZW5jcnlwdCBwYXNzd29yZFxyXG4gICAgICAgICAgICBjb25zdCBzYWx0ID0gYmNyeXB0LmdlblNhbHRTeW5jKHNhbHRSb3VuZHMpO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNoID0gYmNyeXB0Lmhhc2hTeW5jKHVzZXJPYmoucGFzc3dvcmQsIHNhbHQpO1xyXG4gICAgICAgICAgICB1c2VyT2JqLnBhc3N3b3JkID0gaGFzaDtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh1c2VyT2JqKTtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImluIGZ1blwiK3VzZXJPYmoucGFzc3dvcmQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG5ld1VzZXIgPSBuZXcgdXNlckNyZWRlbnRpYWwodXNlck9iaik7XHJcbiAgICAgICAgICAgIG5ld1VzZXIuc2F2ZShmdW5jdGlvbiAoZXJyLCB1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogZXJyIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiB1c2VyIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy9mdW5jdGlvbiB0byBsb2dpbiB1c2VyIGFuZCBzZW5kIHRva2VuXHJcbmV4cG9ydHMubG9naW5Vc2VyID0gZnVuY3Rpb24gKHJlcSwgcmVzKSB7XHJcbiAgICAvL2NvbnNvbGUubG9nKHJlcS5ib2R5KTtcclxuICAgIGVtYWlsID0gcmVxLmJvZHkuZW1haWw7XHJcbiAgICBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkO1xyXG4gICAgaXNNYXRjaCA9IGZhbHNlO1xyXG4gICAgdXNlckNyZWRlbnRpYWwuZmluZE9uZSh7IGVtYWlsOiBlbWFpbCB9LCBmdW5jdGlvbiAoZXJyLCB1c2VyKSB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vY29tcGFyZSBoYXNoZWQgcGFzc3dvcmRcclxuICAgICAgICAgICAgaXNNYXRjaCA9IGJjcnlwdC5jb21wYXJlU3luYyhwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XHJcbiAgICAgICAgICAgIGlmIChpc01hdGNoKSB7XHJcbiAgICAgICAgICAgICAgICB1c2VyZGF0YUluVG9rZW4gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlclR5cGU6IHVzZXIudXNlclR5cGVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gZ2VuZXJhdGVBY2Nlc3NUb2tlbih1c2VyZGF0YUluVG9rZW4pXHJcbiAgICAgICAgICAgICAgICAvL2NvbnN0IHJlZnJlc2hUb2tlbiA9IGp3dC5zaWduKHVzZXIsIHByb2Nlc3MuZW52LlJFRlJFU0hfVE9LRU5fU0VDUkVUKVxyXG4gICAgICAgICAgICAgICAgLy9yZWZyZXNoVG9rZW5zLnB1c2gocmVmcmVzaFRva2VuKVxyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBhY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW4sIHVzZXJEYXRhOiB1c2VyZGF0YUluVG9rZW4gfSlcclxuICAgICAgICAgICAgICAgIC8vcmVzLmpzb24odXNlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcInBhc3N3b3JkIGluY29ycmVjdFwiIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiZW1haWwgbm90IHByZXNlbnRcIiB9KVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuLy9mdW5jdGlvbiB0byBkZWxldGUgdXNlciBvbiByZXF1ZXN0IG9mIGFkbWluXHJcbmV4cG9ydHMuZGVsZXRlVXNlciA9IGZ1bmN0aW9uIChyZXEsIHJlcykge1xyXG4gICAgLy9oZXJlIHJlcS51c2VyIGNvbWVzIGZyb20gYXV0aGVudGljYXRpb24gZnVuY3Rpb25cclxuICAgIGlmIChyZXEudXNlci51c2VyVHlwZSA9PSBcImFkbWluXCIpIHtcclxuICAgICAgICBlbWFpbCA9IHJlcS5wYXJhbXMuaWQ7XHJcbiAgICAgICAgdXNlckNyZWRlbnRpYWwuZGVsZXRlT25lKHsgZW1haWw6IGVtYWlsIH0sIGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogZXJyIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiB1c2VyIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcInVzZXIgbm90IGZvdW5kXCIgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmVzLmpzb24oe3N1Y2Nlc3M6IGZhbHNlLG1lc3NhZ2U6XCJ1c2VyIGlzIG5vdCBhZG1pblwifSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vZnVuY3Rpb24gdG8gc2VuZCBhbGwgdXNlcnMgZW1haWxzIGlkIGZvciB2YWxpZGF0aW9uIG9mIGR1cGxpY2F0ZSBlbWFpbFxyXG5leHBvcnRzLmdldFVzZXJzRW1haWwgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuXHJcbiAgICB1c2VyQ3JlZGVudGlhbC5maW5kKHt9LHtcImVtYWlsXCI6MX0pXHJcbiAgICAudGhlbigoZW1haWxzKT0+XHJcbiAgICB7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhlbWFpbHMpO1xyXG4gICAgICAgIHJlcy5qc29uKHtzdWNjZXNzOnRydWUsIG1lc3NhZ2U6ZW1haWxzfSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpPT5cclxuICAgIHtcclxuICAgICAgICByZXMuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ZXJyfSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5cclxuXHJcbi8vZnVuY3Rpb24gdG8gYXV0aG9yaXplIHVzZXIgZnJvbSBkaWZmZXJlbnQgbWljcm8gc2VydmljZVxyXG5leHBvcnRzLmF1dGhvcml6ZVVzZXIgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuICAgIC8vY29uc29sZS5sb2coXCJhdXRob3JpemVkXCIpO1xyXG4gICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiByZXEudXNlciB9KVxyXG59XHJcblxyXG4vL2Z1bmN0aW9uIHRvIGF1dGhlbnRpY2F0ZSB0b2tlblxyXG5leHBvcnRzLmF1dGhlbnRpY2F0ZVRva2VuID0gZnVuY3Rpb24gKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTtcclxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07XHJcbiAgICAvL2lmIHRoZXJlICBpbiBubyB0b2tlbiBwcmVzZW50IG9yIG5vIGF1dGhvcml6YXRpb24gaGVhZGVyIGl0IHdpbGwgc2VuZCA0MDFcclxuICAgIGlmICh0b2tlbiA9PSBudWxsKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTtcclxuXHJcbiAgICBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5BQ0NFU1NfVE9LRU5fU0VDUkVULCAoZXJyLCB1c2VyZGF0YUluVG9rZW4pID0+IHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKGVycilcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAzKTtcclxuICAgICAgICByZXEudXNlciA9IHVzZXJkYXRhSW5Ub2tlbjtcclxuICAgICAgICBuZXh0KClcclxuICAgIH0pXHJcbn1cclxuXHJcblxyXG4vL2Z1bmN0aW9uIHRvIGdlbmVyYXRlIHRva2VuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlQWNjZXNzVG9rZW4odXNlck9iaikge1xyXG4gICAgcmV0dXJuIGp3dC5zaWduKHVzZXJPYmosIHByb2Nlc3MuZW52LkFDQ0VTU19UT0tFTl9TRUNSRVQsIHsgZXhwaXJlc0luOiAnM2gnIH0pXHJcbn1cclxuIl19